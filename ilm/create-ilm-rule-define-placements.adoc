---
permalink: ilm/create-ilm-rule-define-placements.html 
sidebar: sidebar 
keywords: ilm rule step 2, define placements 
summary: '通过创建ILM规则向导的定义放置位置步骤、您可以定义放置说明、这些放置说明可确定对象的存储时长、副本类型\(已复制或已删除编码\)、存储位置以及副本数量。' 
---
= 第 2 步，共 3 步：定义放置位置
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
通过创建ILM规则向导的*定义放置位置*步骤、您可以定义放置说明、这些放置说明确定对象的存储时长、副本类型(已复制或已删除编码)、存储位置以及副本数量。


NOTE: 所示屏幕截图仅为示例。结果可能因StorageGRID版本而异。

.关于此任务
一个 ILM 规则可以包含一个或多个放置指令。每个放置指令适用场景 都有一段时间。如果使用多个指令，则时间段必须是连续的，并且至少有一个指令必须从第 0 天开始。这些说明可以永久继续，也可以一直持续到不再需要任何对象副本为止。

如果要在该时间段内创建不同类型的副本或使用不同的位置，则每个放置指令可以包含多行。

在此示例中、ILM规则会在第一年将一个复制副本存储在站点1中、并将一个复制副本存储在站点2中。一年后，将创建 2+1 纠删编码副本，并仅保存在一个站点上。

image::../media/ilm_create_ilm_rule_wizard_2.png[创建ILM规则向导步骤2.]

.步骤
. 对于*参考时间*，选择在计算放置指令的开始时间时要使用的时间类型。
+
[cols="1a,2a"]
|===
| 选项 | 说明 


 a| 
载入时间
 a| 
对象的载入时间。



 a| 
上次访问时间
 a| 
上次检索（读取或查看）对象的时间。

要使用此选项、必须为S3存储分段启用上次访问时间更新。请参阅 link:using-last-access-time-in-ilm-rules.html["在ILM规则中使用上次访问时间"]。



 a| 
用户定义的创建时间
 a| 
在用户定义的元数据中指定的时间。



 a| 
非当前时间
 a| 
如果您在中为问题“仅将此规则应用于较旧的对象版本(在启用了版本控制的S3存储分段中)？”选择了*是*，则会自动选择“非当前时间”link:create-ilm-rule-enter-details.html["创建ILM规则向导的第1步"]。

|===
+
如果要创建_PROMENTINY_规则、则必须选择*内嵌时间*。请参阅 link:managing-objects-with-s3-object-lock.html["使用 S3 对象锁定管理对象"]。

. 在*时间段和位置*部分中，输入第一个时间段的开始时间和持续时间。
+
例如、您可能希望指定第一年的对象存储位置(_from day 0 store for 365 days_）。至少有一个指令必须从第 0 天开始。

. 如果要创建复制的副本：
+
.. 从*存储对象依据*下拉列表中，选择*复制*。
.. 选择要创建的副本数。
+
如果将副本数更改为 1 ，则会显示一条警告。如果 ILM 规则在任何时间段内仅创建一个复制副本，则会使数据面临永久丢失的风险。请参阅 link:why-you-should-not-use-single-copy-replication.html["为什么不应使用单副本复制"]。

+
要避免此风险、请执行以下一项或多项操作：

+
*** 增加时间段内的副本数。
*** 向其他存储池或云存储池添加副本。
*** 选择*纠删编码*，而不选择*复制*。
+
如果此规则已在所有时间段创建多个副本，则可以安全地忽略此警告。



.. 在*副本位置*字段中、选择要添加的存储池。
+
* 如果仅指定一个存储池 * ，请注意， StorageGRID 只能在任何给定存储节点上存储一个对象的一个复制副本。如果您的网格包含三个存储节点、而您选择4作为副本数、则只会创建三个副本&#8212；每个存储节点一个副本。

+
系统将触发 * 无法实现 ILM 放置 * 警报，以指示无法完全应用 ILM 规则。

+
* 如果指定多个存储池 * ，请记住以下规则：

+
*** 副本数不能大于存储池数。
*** 如果副本数等于存储池数，则每个存储池中将存储一个对象副本。
*** 如果副本数小于存储池数、则会在载入站点存储一个副本、然后系统会分发其余副本、以保持池中的磁盘使用量保持平衡、同时确保任何站点都不会获得一个对象的多个副本。
*** 如果存储池重叠（包含相同的存储节点），则对象的所有副本可能只保存在一个站点上。因此、请勿指定所有存储节点存储池(StorageGRID 11.6及更早版本)和其他存储池。




. 如果要创建经过纠删编码的副本：
+
.. 从*存储对象依据*下拉列表中，选择*纠删编码*。
+

NOTE: 纠删编码最适合大于 1 MB 的对象。不要对小于200 KB的对象使用纠删编码、以避免管理非常小的经过纠删编码的片段所产生的开销。

.. 如果没有为大于200 KB的值添加对象大小筛选器，请选择*Previer*返回到步骤1。然后，选择*添加高级筛选器*并将*对象大小*筛选器设置为大于200 KB的任何值。
.. 选择要添加的存储池以及要使用的纠删编码方案。
+
纠删编码副本的存储位置包括纠删编码方案的名称、后跟存储池的名称。

+
可用的纠删编码方案受所选存储池中存储节点的数量限制。提供的方案旁边会出现一个 `Recommended`标志link:../ilm/what-erasure-coding-schemes-are.html["提供最佳保护或最低存储开销"]。



. (可选)：
+
.. 选择*添加其他类型或位置*可在不同位置创建其他副本。
.. 选择*添加其他时间段*以添加不同的时间段。
+
[NOTE]
====
对象删除基于以下设置进行：

*** 除非另一个时间段以*forever *结尾、否则对象将在最后一个时间段结束时自动删除。
*** 根据link:../ilm/example-8-priorities-for-s3-bucket-lifecycle-and-ilm-policy.html#example-of-bucket-lifecycle-taking-priority-over-ilm-policy["存储分段和租户保留期限设置"]，即使ILM保留期限结束，也可能不会删除对象。


====


. 如果要将对象存储在云存储池中：
+
.. 在*存储对象依据*下拉列表中，选择*复制*。
.. 选择*复制位置*字段、然后选择云存储池。
+
使用云存储池时，请记住以下规则：

+
*** 您不能在一个放置说明中选择多个云存储池。同样、您也不能在同一放置说明中选择云存储池和存储池。
*** 您只能在任何给定的云存储池中存储一个对象的一个副本。如果将 * 副本 * 设置为 2 或更多，则会显示一条错误消息。
*** 不能同时在任何云存储池中存储多个对象副本。如果使用云存储池的多个放置位置的日期重叠，或者同一放置中的多个行使用云存储池，则会显示错误消息。
*** 您可以将对象存储在云存储池中、同时将该对象存储为StorageGRID中的复制副本或经过删除编码的副本。但是、您必须在该时间段的放置说明中包含多行、才能指定每个位置的副本数量和类型。




. 在保留图中、确认您的放置说明。
+
在此示例中、ILM规则会在第一年将一个复制副本存储在站点1中、并将一个复制副本存储在站点2中。一年后、再过10年、三个站点将保存一份6+3经过删除的副本。总共11年后、这些对象将从StorageGRID 中删除。

+
保留图的规则分析部分指出：

+
** 在此规则有效期内、StorageGRID 站点丢失保护将适用。
** 此规则处理的对象将在第4015天后删除。
+
请参见 link:using-multiple-storage-pools-for-cross-site-replication.html["启用站点丢失保护。"]

+
image::../media/ilm_rule_retention_diagram.png[ILM 规则保留图]



. 选择 * 继续 * 。link:create-ilm-rule-select-ingest-behavior.html["第3步(选择加热行为)"]的创建ILM规则向导。

