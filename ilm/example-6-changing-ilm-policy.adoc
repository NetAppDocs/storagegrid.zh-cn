---
permalink: ilm/example-6-changing-ilm-policy.html 
sidebar: sidebar 
keywords: change ILM policy, example ILM policy, information lifecycle policy example 
summary: 如果需要更改数据保护或添加新站点、则可以创建并激活新的ILM策略。 
---
= 示例6：更改ILM策略
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
如果需要更改数据保护或添加新站点、则可以创建并激活新的ILM策略。

在更改策略之前，您必须了解 ILM 放置的更改如何临时影响 StorageGRID 系统的整体性能。

在此示例中、扩展中添加了一个新的StorageGRID 站点、需要实施一个新的活动ILM策略、以便在新站点上存储数据。要实施新的活动策略，请首先link:creating-ilm-policy.html["创建策略"]。之后、您必须link:../ilm/creating-ilm-policy.html#simulate-ilm-policy["模拟"]先执行新策略、然后再link:../ilm/creating-ilm-policy.html#activate-ilm-policy["激活"]执行新策略。


CAUTION: 以下 ILM 规则和策略仅为示例。配置 ILM 规则的方法有多种。在激活新策略之前、请对其进行模拟、以确认其是否按预期工作、以防止内容丢失。



== 更改ILM策略如何影响性能

激活新的 ILM 策略时， StorageGRID 系统的性能可能会暂时受到影响，尤其是在新策略中的放置说明要求将许多现有对象移动到新位置时。

激活新的 ILM 策略时， StorageGRID 会使用它来管理所有对象，包括现有对象和新载入的对象。在激活新的 ILM 策略之前，请查看对现有复制对象和纠删编码对象的放置方式所做的任何更改。在评估和实施新放置时，更改现有对象的位置可能会导致临时资源问题。

要确保新的ILM策略不会影响现有复制的和经过删除编码的对象的放置，您可以link:create-ilm-rule-enter-details.html#use-advanced-filters-in-ilm-rules["创建具有"加网时间"筛选器的ILM规则"]。例如，*Ingt time _is on or after _<date and time> _*，这样新规则只适用于在指定日期和时间或之后插入的对象。

可能会暂时影响 StorageGRID 性能的 ILM 策略更改类型包括：

* 将不同的纠删编码配置文件应用于现有的纠删编码对象。
+

NOTE: StorageGRID认为每个纠删编码配置文件都是唯一的、在使用新配置文件时不会重复使用纠删编码片段。

* 更改现有对象所需的副本类型；例如，将大量复制对象转换为经过纠删编码的对象。
* 将现有对象的副本移动到完全不同的位置；例如，将大量对象移入或移出云存储池，或者移动到远程站点或从远程站点移动。




== 示例 6 中的活动 ILM 策略：两个站点的数据保护

在此示例中，活动 ILM 策略最初是为双站点 StorageGRID 系统设计的，并使用两个 ILM 规则。

image::../media/policy_6_active_policy.png[ILM 策略 6 活动策略示例]

在此 ILM 策略中，属于租户 A 的对象在一个站点上通过 2+1 纠删编码进行保护，而属于所有其他租户的对象则通过双副本复制在两个站点之间进行保护。



=== 规则 1 ：租户 A 的单站点纠删编码

[cols="1a,2a"]
|===
| 规则定义 | 示例值 


 a| 
规则名称
 a| 
租户 A 的单站点擦除编码



 a| 
租户帐户
 a| 
租户 A



 a| 
存储池
 a| 
站点1



 a| 
放置
 a| 
站点1中2+1纠删编码从第0天到永久

|===


=== 规则 2 ：为其他租户进行双站点复制

[cols="1a,2a"]
|===
| 规则定义 | 示例值 


 a| 
规则名称
 a| 
适用于其他租户的双站点复制



 a| 
租户帐户
 a| 
忽略



 a| 
存储池
 a| 
站点1和站点2



 a| 
放置
 a| 
从Day 0到Forever的两个复制副本：一个副本位于站点1、一个副本位于站点2。

|===


== ILM策略例如示例6：在三个站点上保护数据

在此示例中、三站点StorageGRID 系统的ILM策略将被替换为新策略。

在执行扩展以添加新站点后、网格管理员创建了两个新存储池：站点3的存储池和包含所有三个站点的存储池(与所有存储节点的默认存储池不同)。然后、管理员创建了两个新的ILM规则和一个新的ILM策略、旨在保护所有三个站点的数据。

激活此新 ILM 策略后，属于租户 A 的对象将在三个站点上通过 2+1 纠删编码得到保护，而属于其他租户（以及属于租户 A 的较小对象）的对象将通过三个副本复制在三个站点上得到保护。



=== 规则 1 ：租户 A 的三站点纠删编码

[cols="1a,2a"]
|===
| 规则定义 | 示例值 


 a| 
规则名称
 a| 
租户 A 的三站点擦除编码



 a| 
租户帐户
 a| 
租户 A



 a| 
存储池
 a| 
所有3个站点(包括站点1、站点2和站点3)



 a| 
放置
 a| 
从第0天到永远、在所有3个站点中执行2+1纠删编码

|===


=== 规则 2 ：对其他租户进行三站点复制

[cols="1a,2a"]
|===
| 规则定义 | 示例值 


 a| 
规则名称
 a| 
适用于其他租户的三站点复制



 a| 
租户帐户
 a| 
忽略



 a| 
存储池
 a| 
站点1、站点2和站点3



 a| 
放置
 a| 
从Day 0到Forever的三个复制副本：一个副本位于站点1、一个副本位于站点2、一个副本位于站点3。

|===


== 激活ILM策略、例如6

激活新ILM策略时、根据任何新规则或更新规则中的放置说明、现有对象可能会移动到新位置、或者可能会为现有对象创建新的对象副本。


CAUTION: ILM 策略中的错误可能会导致发生原因 丢失不可恢复的数据。在激活策略之前，请仔细查看并模拟策略，以确认策略将按预期运行。


CAUTION: 激活新的 ILM 策略时， StorageGRID 会使用它来管理所有对象，包括现有对象和新载入的对象。在激活新的 ILM 策略之前，请查看对现有复制对象和纠删编码对象的放置方式所做的任何更改。在评估和实施新放置时，更改现有对象的位置可能会导致临时资源问题。



=== 擦除编码指令发生变化时会发生什么情况

在本示例的当前活动ILM策略中、属于租户A的对象将在站点1上使用2+1纠删编码进行保护。在新的ILM策略中、属于租户A的对象将在站点1、2和3上使用2+1纠删编码进行保护。

激活新的 ILM 策略后，将执行以下 ILM 操作：

* 租户 A 输入的新对象将拆分为两个数据片段，并添加一个奇偶校验片段。然后、这三个片段中的每一个都存储在不同的站点上。
* 属于租户 A 的现有对象将在进行 ILM 扫描过程中重新评估。由于ILM放置指令使用新的纠删编码配置文件、因此会创建全新的纠删编码片段并将其分发到三个站点。
+

NOTE: 站点1上的现有2+1片段不会重复使用。StorageGRID认为每个纠删编码配置文件都是唯一的、在使用新配置文件时不会重复使用纠删编码片段。





=== 复制指令发生变化时会发生什么情况

在此示例中、在当前活动的ILM策略中、属于其他租户的对象将通过站点1和2的存储池中的两个复制副本受到保护。在新的ILM策略中、属于其他租户的对象将使用站点1、2和3的存储池中的三个复制副本进行保护。

激活新的 ILM 策略后，将执行以下 ILM 操作：

* 当租户A以外的任何租户都加入新对象时、StorageGRID 会创建三个副本、并在每个站点保存一个副本。
* 属于这些其他租户的现有对象将在进行中的 ILM 扫描过程中重新评估。由于站点1和站点2上的现有对象副本仍然满足新ILM规则的复制要求、因此StorageGRID 只需要为站点3创建一个新的对象副本。




=== 激活此策略对性能的影响

激活此示例中的ILM策略后、此StorageGRID系统的整体性能将暂时受到影响。要为租户A的现有对象创建新的已删除编码片段、并在站点3为其他租户的现有对象创建新的复制副本、需要使用高于正常级别的网格资源。

由于 ILM 策略发生更改，客户端读取和写入请求可能会暂时出现比正常延迟高的情况。在整个网格中完全实施放置说明后，延迟将恢复到正常水平。

为了避免激活新ILM策略时出现资源问题、您可以在任何可能更改大量现有对象位置的规则中使用"IngTime advanced"筛选器。将"Inged Time (启动时间)"设置为大于或等于新策略生效的大致时间、以确保现有对象不会发生不必要的移动。


NOTE: 如果在 ILM 策略更改后需要降低或提高对象的处理速度，请联系技术支持。
