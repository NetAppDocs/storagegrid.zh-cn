---
permalink: ilm/example-4-ilm-rules-and-policy-for-s3-versioned-objects.html 
sidebar: sidebar 
keywords: object versions, example ILM rule, information lifecycle rule examples 
summary: 如果您的S3存储分段启用了版本控制、则可以通过在ILM策略中包含使用非当前时间作为参考时间的规则来管理非当前对象版本。 
---
= 示例 4 ： S3 版本对象的 ILM 规则和策略
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
如果您的S3存储分段启用了版本控制、则可以通过在ILM策略中包含使用"非当前时间"作为参考时间的规则来管理非当前对象版本。


CAUTION: 如果为对象指定了有限的保留时间、则在达到该时间段后、这些对象将被永久删除。确保您了解对象的保留时间。

如本示例所示，您可以通过对非当前对象版本使用不同的放置说明来控制受版本控制的对象使用的存储量。


CAUTION: 以下 ILM 规则和策略仅为示例。配置 ILM 规则的方法有多种。在激活新策略之前、请对其进行模拟、以确认其是否按预期工作、以防止内容丢失。


NOTE: 要对非最新版本的对象执行ILM策略模拟、您必须知道对象版本的UUID或CBID。要查找UUID和CBID、请在对象仍为最新时使用link:verifying-ilm-policy-with-object-metadata-lookup.html["对象元数据查找"]。

.相关信息
link:how-objects-are-deleted.html["如何删除对象"]



== ILM 规则 1 示例 4 ：保存三个副本并保留 10 年

此示例ILM规则会将每个对象的副本存储在三个站点上、为期10年。

此规则将适用场景 所有对象，无论它们是否已受版本控制。

[cols="1a,2a"]
|===
| 规则定义 | 示例值 


 a| 
存储池
 a| 
三个存储池、每个存储池由不同的数据中心组成、分别命名为站点1、站点2和站点3。



 a| 
规则名称
 a| 
三个副本十年



 a| 
参考时间
 a| 
载入时间



 a| 
放置
 a| 
在第0天、将三个复制副本保留10年(3、752天)、一个在站点1、一个在站点2、一个在站点3。10 年后，删除对象的所有副本。

|===


== ILM 规则 2 示例 4 ：将两个非最新版本副本保存 2 年

此示例 ILM 规则会将 S3 版本对象的两个非最新版本副本存储 2 年。

由于 ILM 规则 1 会对对象的所有版本进行适用场景 处理，因此您必须创建另一个规则来筛选出任何非最新版本。

要创建使用"非当前时间"作为参考时间的规则、请为问题"仅将此规则应用于较旧的对象版本(在启用了版本控制的S3存储分段中)？"选择*是* 在创建ILM规则向导的步骤1 (输入详细信息)中。选择*是*时，系统会自动为参考时间选择_noncurrent time_，您不能选择其他参考时间。

image::../media/ilm-rule-apply-only-to-older-object-verions.png[仅将ILM规则应用于较早的对象版本(非当前时间)]

在此示例中，仅存储两个非最新版本副本，这些副本将存储两年。

[cols="1a,2a"]
|===
| 规则定义 | 示例值 


 a| 
存储池
 a| 
两个存储池、分别位于不同的数据中心站点1和站点2。



 a| 
规则名称
 a| 
非最新版本：两个副本，两年



 a| 
参考时间
 a| 
非当前时间

当您为"仅将此规则应用于较旧的对象版本(在启用了版本控制的S3存储分段中)？"问题选择*是*时、系统会自动选中此选项 在创建ILM规则向导中。



 a| 
放置
 a| 
在相对于非当前时间的第0天(即、从对象版本成为非当前版本之日开始)、将非当前对象版本的两个复制副本保留2年(730天)、一个在站点1、一个在站点2。2 年后，删除非最新版本。

|===


== ILM 策略示例 4 ： S3 版本对象

如果要以与当前版本不同的方式管理对象的旧版本、则使用"非当前时间"作为参考时间的规则必须显示在ILM策略中、然后才会显示应用于当前对象版本的规则。

S3 版本对象的 ILM 策略可能包括以下 ILM 规则：

* 从每个对象的任何较旧（非最新）版本变为非最新版本之日起，保留两年。
+

NOTE: 策略中必须先显示"非当前时间"规则、然后再显示应用于当前对象版本的规则。否则、"非当前时间"规则将永远无法匹配非当前对象版本。

* 在执行数据加热时、创建三个复制副本、并在三个站点中的每个站点上存储一个副本。将当前对象版本的副本保留 10 年。


模拟此示例策略时，您希望按如下所示评估测试对象：

* 第一个规则将匹配任何非最新的对象版本。如果非当前对象版本超过 2 年，则 ILM 会将其永久删除（非当前版本的所有副本都会从网格中删除）。
* 当前对象版本将与第二个规则匹配。当当前对象版本已存储10年时、ILM过程会添加一个删除标记作为对象的当前版本、并使以前的对象版本"非当前"。下次进行ILM评估时、此非最新版本将与第一条规则匹配。因此、站点3上的副本将被清除、站点1和站点2上的两个副本将再存储2年。

