---
permalink: monitor/email-alert-notifications.html 
sidebar: sidebar 
keywords: how to disable alert rules, how to remove a custom alert rule 
summary: 如果您希望在出现警报时发送电子邮件通知，则必须提供有关 SMTP 服务器的信息。您还必须输入警报通知收件人的电子邮件地址。 
---
= 为警报设置电子邮件通知
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
如果您希望在出现警报时发送电子邮件通知，则必须提供有关 SMTP 服务器的信息。您还必须输入警报通知收件人的电子邮件地址。

.开始之前
* 您已使用登录到网格管理器link:../admin/web-browser-requirements.html["支持的 Web 浏览器"]。
* 您拥有link:../admin/admin-group-permissions.html["管理警报或root访问权限"]。


.关于此任务
用于警报通知的电子邮件设置不适用于AutoSupport软件包。但是，您可以对所有通知使用同一个电子邮件服务器。

如果您的StorageGRID部署包含多个管理节点、则主管理节点是警报通知、AutoSupport软件包以及SNMP陷阱和通知的首选发送方。如果主管理节点不可用、则其他管理节点会临时发送通知。请参阅。 link:../primer/what-admin-node-is.html["什么是管理节点？"]

.步骤
. 选择*警报* > *电子邮件设置*。
+
此时将显示电子邮件设置页面。

. 选中*启用电子邮件通知*复选框以指示您希望在警报达到配置的阈值时发送通知电子邮件。
+
此时将显示电子邮件（ SMTP ）服务器，传输层安全（ TLS ），电子邮件地址和筛选器部分。

. 在电子邮件（ SMTP ）服务器部分中，输入 StorageGRID 访问 SMTP 服务器所需的信息。
+
如果 SMTP 服务器需要身份验证，则必须同时提供用户名和密码。

+
[cols="1a,2a"]
|===
| 字段 | 输入 


 a| 
邮件服务器
 a| 
SMTP 服务器的完全限定域名（ FQDN ）或 IP 地址。



 a| 
端口
 a| 
用于访问 SMTP 服务器的端口。必须介于 1 到 65535 之间。



 a| 
用户名（可选）
 a| 
如果 SMTP 服务器需要身份验证，请输入要进行身份验证的用户名。



 a| 
密码（可选）
 a| 
如果 SMTP 服务器需要身份验证，请输入用于进行身份验证的密码。

|===
. 在电子邮件地址部分中，输入发件人和每个收件人的电子邮件地址。
+
.. 对于 * 发件人电子邮件地址 * ，请指定一个有效的电子邮件地址，用作警报通知的发件人地址。
+
例如： `storagegrid-alerts@example.com`

.. 在收件人部分中，为每个电子邮件列表或发生警报时应接收电子邮件的人员输入电子邮件地址。
+
选择加号图标image:../media/icon_plus_sign_black_on_white.gif["加号图标"]以添加收件人。



. 如果要与 SMTP 服务器进行通信，需要使用传输层安全（ TLS ），请在传输层安全（ TLS ）部分中选择 * 需要 TLS* 。
+
.. 在 * CA 证书 * 字段中，提供用于验证 SMTP 服务器标识的 CA 证书。
+
您可以将内容复制并粘贴到此字段中，或者选择 * 浏览 * 并选择文件。

+
您必须提供一个文件，其中包含来自每个中间颁发证书颁发机构（ CA ）的证书。此文件应包含 PEM 编码的每个 CA 证书文件，并按证书链顺序串联。

.. 如果SMTP电子邮件服务器要求电子邮件发件人提供客户端证书以进行身份验证，请选中*发送客户端证书*复选框。
.. 在 * 客户端证书 * 字段中，提供 PEM 编码的客户端证书以发送到 SMTP 服务器。
+
您可以将内容复制并粘贴到此字段中，或者选择 * 浏览 * 并选择文件。

.. 在 * 专用密钥 * 字段中，输入未加密 PEM 编码的客户端证书的专用密钥。
+
您可以将内容复制并粘贴到此字段中，或者选择 * 浏览 * 并选择文件。

+

NOTE: 如果您需要编辑电子邮件设置、请选择铅笔图标image:../media/icon_edit_tm.png["编辑图标"]以更新此字段。



. 在筛选器部分中，选择应导致电子邮件通知的警报严重性级别，除非特定警报的规则已被静音。
+
[cols="1a,2a"]
|===
| 严重性 | 说明 


 a| 
次要，重大，严重
 a| 
满足警报规则的次要，主要或严重条件时，系统会发送电子邮件通知。



 a| 
主要，关键
 a| 
当满足警报规则的主要或关键条件时，系统会发送电子邮件通知。不会针对次要警报发送通知。



 a| 
仅严重
 a| 
只有在满足警报规则的严重条件时，才会发送电子邮件通知。不会针对次要或重大警报发送通知。

|===
. 准备好测试电子邮件设置后，请执行以下步骤：
+
.. 选择 * 发送测试电子邮件 * 。
+
此时将显示一条确认消息，指示已发送测试电子邮件。

.. 检查所有电子邮件收件人的收件箱，确认已收到测试电子邮件。
+

NOTE: 如果在几分钟内未收到电子邮件，或者触发了 * 电子邮件通知失败 * 警报，请检查您的设置并重试。

.. 登录到任何其他管理节点并发送测试电子邮件以验证所有站点的连接。
+

NOTE: 在测试警报通知时，您必须登录到每个管理节点以验证连接。这与测试AutoSupport软件包不同、在测试软件包中、所有管理节点都会发送测试电子邮件。



. 选择 * 保存 * 。
+
发送测试电子邮件不会保存您的设置。您必须选择 * 保存 * 。

+
此时将保存电子邮件设置。





== 警报电子邮件通知中包含的信息

配置 SMTP 电子邮件服务器后，在触发警报时，系统会向指定的收件人发送电子邮件通知，除非警报规则被静默禁止。请参阅。 link:silencing-alert-notifications.html["静默警报通知"]

电子邮件通知包括以下信息：

image::../media/alerts_email_notification.png[警报电子邮件通知]

[cols="1a,6a"]
|===
| Callout | 说明 


 a| 
1
 a| 
警报名称，后跟此警报的活动实例数。



 a| 
2
 a| 
警报的问题描述 。



 a| 
3
 a| 
为警报建议的任何操作。



 a| 
4
 a| 
有关警报的每个活动实例的详细信息，包括受影响的节点和站点，警报严重性，触发警报规则的 UTC 时间以及受影响作业和服务的名称。



 a| 
5
 a| 
发送通知的管理节点的主机名。

|===


== 如何对警报进行分组

为了防止在触发警报时发送过多的电子邮件通知， StorageGRID 会尝试在同一通知中对多个警报进行分组。

有关 StorageGRID 如何在电子邮件通知中对多个警报进行分组的示例，请参见下表。

[cols="1a,1a"]
|===
| 行为 | 示例 


 a| 
每个警报通知仅适用于同名警报。如果同时触发两个名称不同的警报，则会发送两封电子邮件通知。
 a| 
* 警报 A 会同时在两个节点上触发。仅发送一个通知。
* 节点 1 上触发警报 A ，节点 2 上同时触发警报 B 。系统会发送两个通知—每个警报一个。




 a| 
对于特定节点上的特定警报，如果达到阈值的严重性超过一个，则仅针对最严重警报发送通知。
 a| 
* 此时将触发警报 A ，并达到次要，主要和严重警报阈值。系统会为严重警报发送一条通知。




 a| 
首次触发警报时， StorageGRID 会等待 2 分钟，然后再发送通知。如果在此期间触发了其他同名警报，则 StorageGRID 会在初始通知中对所有警报进行分组。​
 a| 
. 警报A在08：00在节点1上触发。不会发送任何通知。
. 警报A在节点2上于08：01触发。不会发送任何通知。
. 在08：02时、系统会发送通知以报告这两个警报实例。




 a| 
如果触发另一个同名警报， StorageGRID 将等待 10 分钟，然后再发送新通知。新通知会报告所有活动警报（当前未静音的警报），即使先前已报告这些警报也是如此。
 a| 
. 警报A在08：00在节点1上触发。通知将在08：02发送。
. 警报A于08：05在节点2上触发。第二个通知将在08：15 (10分钟后)发送。此时将报告这两个节点。




 a| 
如果当前存在多个同名警报且其中一个警报已解决，则在已解决警报的节点上重新出现此警报时，不会发送新通知。
 a| 
. 已针对节点 1 触发警报 A 。此时将发送通知。
. 已针对节点 2 触发警报 A 。此时将发送第二个通知。
. 已解决节点 2 的警报 A ，但此警报对于节点 1 仍处于活动状态。
. 此时将再次触发节点 2 的警报 A 。不会发送任何新通知，因为此警报对于节点 1 仍处于活动状态。




 a| 
StorageGRID 会继续每 7 天发送一次电子邮件通知，直到所有警报实例均已解决或警报规则已静音为止。
 a| 
. 3 月 8 日为节点 1 触发警报 A 。此时将发送通知。
. 警报 A 未解决或静音。其他通知将于 3 月 15 日， 3 月 22 日， 3 月 29 日等时间发送。


|===


== 对警报电子邮件通知进行故障排除

如果触发了 * 电子邮件通知失败 * 警报，或者您无法收到测试警报电子邮件通知，请按照以下步骤解决问题描述 。

.开始之前
* 您已使用登录到网格管理器link:../admin/web-browser-requirements.html["支持的 Web 浏览器"]。
* 您拥有link:../admin/admin-group-permissions.html["管理警报或root访问权限"]。


.步骤
. 验证设置。
+
.. 选择*警报* > *电子邮件设置*。
.. 验证电子邮件（ SMTP ）服务器设置是否正确。
.. 验证您是否为收件人指定了有效的电子邮件地址。


. 检查垃圾邮件筛选器，确保电子邮件未发送到垃圾文件夹。
. 请您的电子邮件管理员确认来自发件人地址的电子邮件未被阻止。
. 收集管理节点的日志文件，然后联系技术支持。
+
技术支持可以使用日志中的信息帮助确定出现问题的原因。例如， prometheus.log 文件在连接到您指定的服务器时可能会显示错误。

+
请参阅。 link:collecting-log-files-and-system-data.html["收集日志文件和系统数据"]


