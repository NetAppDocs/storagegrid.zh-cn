---
permalink: maintain/restoring-volume.html 
sidebar: sidebar 
keywords: storagegrid, restore, volume 
summary: 您可以使用网格管理器还原发生故障的存储卷或存储节点的对象数据。您还可以使用网格管理器监控正在进行的还原过程并显示还原历史记录。 
---
= 使用网格管理器还原对象数据
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
您可以使用网格管理器还原发生故障的存储卷或存储节点的对象数据。您还可以使用网格管理器监控正在进行的还原过程并显示还原历史记录。

.开始之前
* 您已完成以下任一过程来格式化失败的卷：
+
** link:../maintain/remounting-and-reformatting-appliance-storage-volumes.html["重新挂载并重新格式化设备存储卷(手动步骤)"]
** link:../maintain/remounting-and-reformatting-storage-volumes-manual-steps.html["重新挂载和重新格式化存储卷(手动步骤)"]


* 您已确认要还原对象的存储节点在网格管理器的*NDES*>*Overview*选项卡上的连接状态为*conny*。image:../media/icon_alert_green_checkmark.png["图标警报绿色复选标记"]
* 您已确认以下内容：
+
** 未进行网格扩展以添加存储节点。
** 存储节点取消配置未在进行中或失败。
** 未在恢复发生故障的存储卷。
** 未在恢复系统驱动器发生故障的存储节点。
** EC重新平衡作业未在进行中。
** 设备节点克隆未在进行中。




.关于此任务
在更换驱动器并执行手动步骤格式化卷之后，Grid Manager会在*Maintenance >*Volume reRestore*>*Nates to reRestore*选项卡上将这些卷显示为待还原的候选卷。

请尽可能使用网格管理器中的卷还原页面还原对象数据。您可以在卷准备好进行还原时自动启动卷还原，也可以<<enable-auto-restore-mode,启用自动还原模式>><<manually-restore,手动执行卷还原>>。请遵循以下准则：

* 如果卷列在*维护*>*卷还原*>*要还原的节点*中、请按照以下步骤中所述还原对象数据。如果出现以下情况、则会列出这些卷：
+
** 节点中的部分(而非全部)存储卷发生故障
** 一个节点中的所有存储卷均发生故障、并正在替换为相同数量或更多卷


+
网格管理器中的卷还原页面还可用于<<view-restoration-progress,监控卷还原过程>>和<<view-restoration-history,查看还原历史记录>>。

* 如果网格管理器中未将这些卷列为要还原的候选卷、请按照相应步骤使用 `repair-data`脚本还原对象数据：
+
** link:restoring-object-data-to-storage-volume.html["将对象数据还原到存储卷(系统驱动器故障)"]
** link:restoring-object-data-to-storage-volume-where-system-drive-is-intact.html["将对象数据还原到系统驱动器完好无损的存储卷"]
** link:restoring-object-data-to-storage-volume-for-appliance.html["将对象数据还原到设备的存储卷"]
+

NOTE: 修复数据脚本已弃用、将在未来版本中删除。



+
如果已恢复的存储节点包含的卷数少于要替换的节点数、则必须使用 `repair-data`脚本。



您可以还原两种类型的对象数据：

* 复制的数据对象会从其他位置还原、前提是已将网格的ILM规则配置为使对象副本可用。
+
** 如果 ILM 规则配置为仅存储一个复制副本，而该副本位于出现故障的存储卷上，则您将无法恢复对象。
** 如果某个对象的唯一剩余副本位于云存储池中，则 StorageGRID 必须将多个请求问题描述 到云存储池端点以还原对象数据。


* 纠删编码(纠删编码、EC)数据对象可通过重新组装存储的片段来还原。损坏或丢失的片段会通过纠删编码算法从其余数据和奇偶校验片段中重新创建。
+
在某些存储节点脱机时，可以开始修复经过擦除编码的数据。但是、如果无法计算出所有经过数据检索的数据、则无法完成修复。修复将在所有节点均可用后完成。




NOTE: 卷还原取决于存储对象副本的资源的可用性。卷还原进度是非线性的、可能需要数天或数周才能完成。



== [[enable－auto－restore－mode]]启用自动恢复模式

启用自动还原模式后、卷还原将在卷准备就绪后自动开始。

.步骤
. 在网格管理器中，转至*Maintenance (维护)*>*Volume restation*(卷还原)。
. 选择*要还原的节点*选项卡，然后将*自动还原模式*的切换滑至启用位置。
. 出现确认对话框时、请查看详细信息。
+
[NOTE]
====
** 您将无法在任何节点上手动启动卷还原作业。
** 只有在没有执行其他维护过程时、卷还原才会自动开始。
** 您可以从进度监控页面监控作业的状态。
** StorageGRID会自动重试无法启动的卷还原。


====
. 了解启用自动恢复模式的结果后，在确认对话框中选择*Yes*。
+
您可以随时禁用自动还原模式。





== [[manually -restore ]]手动还原故障卷或节点

按照以下步骤还原发生故障的卷或节点。

.步骤
. 在网格管理器中，转至*Maintenance (维护)*>*Volume restation*(卷还原)。
. 选择*要还原的节点*选项卡，然后将*自动还原模式*的切换滑至禁用位置。
+
选项卡上的数字表示卷需要还原的节点数。

. 展开每个节点以查看其中需要还原的卷及其状态。
. 更正阻止还原每个卷的所有问题。如果选择*正在等待手动步骤*(如果显示为卷状态)，则会指示出现问题。
. 选择一个要还原的节点、其中所有卷都指示"Ready to Restore"状态。
+
一次只能还原一个节点的卷。

+
节点中的每个卷都必须指示已准备好还原。

. 选择*开始还原*。
. 解决可能出现的任何警告，或者选择*Start anyway *以忽略警告并开始恢复。


恢复开始时，节点将从“要还原的节点”选项卡移至“还原进度”选项卡。

如果无法启动卷还原、则节点将返回到*要还原的节点*选项卡。



== [[view-resistution-Progress ]]查看还原进度

"*还原进度*"选项卡显示卷还原过程的状态以及有关要还原的节点的卷的信息。

所有卷中复制的和经过还原的对象的数据修复率均为平均值、汇总了正在进行的所有修复、包括使用脚本启动的修复 `repair-data`。此外、还会指示这些卷中完好无损且不需要还原的对象的百分比。


NOTE: 复制的数据还原取决于存储复制副本的资源的可用性。复制的数据还原进度是非线性的、可能需要数天或数周才能完成。

"还原作业"部分显示有关从网格管理器启动的卷还原的信息。

* "Restoration Jobs"部分标题中的数字表示正在还原或排队等待还原的卷的数量。
* 此表显示了有关要还原的节点中每个卷的信息及其进度。
+
** 每个节点的进度将显示每个作业的百分比。
** 展开详细信息列以显示还原开始时间和作业ID。


* 如果卷还原失败：
+
** 状态列指示 `failed (attempting retry)`，将自动重试。
** 如果多个还原作业失败、则会首先自动重试最近的作业。
** 如果重试继续失败，将触发*EC修复失败*警报。按照警报中的步骤解决问题描述。






== [[view-resistution-history]]查看还原历史记录

"*还原历史记录*"选项卡显示有关已成功完成的所有卷还原的信息。


NOTE: 大小不适用于复制的对象、仅适用于包含纠删编码(纠删编码、EC)数据对象的还原。
