---
permalink: expand/performing-expansion.html 
sidebar: sidebar 
keywords: expand, expansion procedure 
summary: 执行扩展时，新的网格节点将添加到现有 StorageGRID 部署中。 
---
= 执行扩展
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
执行扩展时，新的网格节点将添加到现有 StorageGRID 部署中。

.开始之前
* 您已使用登录到网格管理器link:../admin/web-browser-requirements.html["支持的 Web 浏览器"]。
* 您具有配置密码短语。
* 您已部署要在此扩展中添加的所有网格节点。
* 您拥有link:../admin/admin-group-permissions.html["维护或root访问权限"]。
* 如果您要添加存储节点，则已确认在恢复过程中执行的所有数据修复操作均已完成。请参阅。 link:../maintain/checking-data-repair-jobs.html["检查数据修复作业"]
* 如果您要添加存储节点，并且要为这些节点分配自定义存储级别，则您已经拥有link:../ilm/creating-and-assigning-storage-grades.html["已创建自定义存储级别"]。此外、您还具有root访问权限、或者同时具有维护和ILM权限。
* 如果要添加新站点、则已查看并更新ILM规则。您必须确保在扩展完成之前不会将对象副本存储到新站点。例如，如果某个规则使用默认存储池(*所有存储节点*)，则必须link:../ilm/creating-storage-pool.html["创建新存储池"]仅包含现有存储节点和link:../ilm/working-with-ilm-rules-and-ilm-policies.html["更新ILM规则"]ILM策略才能使用该新存储池。否则，一旦新站点上的第一个节点变为活动状态，对象就会复制到该站点。


.关于此任务
执行扩展包括以下主要用户任务：

. 配置扩展。
. 开始扩展。
. 下载新的恢复包文件。
. 监控扩展步骤和阶段、直到安装和配置所有新节点并启动所有服务为止。
+

CAUTION: 在大型网格上运行某些扩展步骤和阶段可能需要很长时间。例如，如果 Cassandra 数据库为空，则将 Cassandra 流式传输到新存储节点可能只需要几分钟的时间。但是，如果 Cassandra 数据库包含大量对象元数据，则此阶段可能需要数小时或更长时间。在"扩展Cassandr集群"或"启动Cassandr并流式传输数据"阶段、请勿重新启动任何存储节点。



.步骤
. 选择*维护* > *任务* > *扩展*。
+
此时将显示网格扩展页面。Pending Node部分列出了已准备好添加的节点。

+
image::../media/grid_expansion_page.png[显示网格扩展页面的屏幕截图]

. 选择 * 配置扩展 * 。
+
此时将显示站点选择对话框。

. 选择要启动的扩展类型：
+
** 如果要添加新站点，请选择 * 新建 * ，然后输入新站点的名称。
** 如果要向现有站点添加一个或多个节点，请选择*exist*。


. 选择 * 保存 * 。
. 查看 * 待定节点 * 列表，并确认它显示了您部署的所有网格节点。
+
您可以根据需要将光标置于节点的*网格网络MAC地址*上，以查看有关该节点的详细信息。

+
image::../media/grid_node_details.png[网格节点详细信息的屏幕截图]

+

NOTE: 如果缺少节点、请确认已成功部署该节点。

. 从待定节点列表中、批准要添加到此扩展中的节点。
+
.. 选择要批准的第一个待定网格节点旁边的单选按钮。
.. 选择 * 批准 * 。
+
此时将显示网格节点配置表单。

.. 根据需要修改常规设置：
+
[cols="1a,2a"]
|===
| 字段 | 说明 


 a| 
站点
 a| 
网格节点要关联的站点的名称。如果要添加多个节点，请确保为每个节点选择正确的站点。如果要添加新站点，则所有节点都将添加到新站点。



 a| 
名称
 a| 
节点的系统名称。内部StorageGRID 操作需要系统名称、并且无法更改。



 a| 
存储类型(仅限存储节点)
 a| 
*** *数据和元数据*("组合")：对象-数据和元数据存储节点
*** *仅数据*：存储节点仅包含对象数据(无元数据)
*** *仅元数据*：仅包含元数据(无对象数据)的存储节点




 a| 
NTP角色
 a| 
网格节点的网络时间协议(NTP)角色：

*** 选择*Automatic (自动)*(默认)以自动将NTP角色分配给节点。主要角色将分配给管理节点、具有ADC服务的存储节点、网关节点以及具有非静态IP地址的任何网格节点。客户端角色将分配给所有其他网格节点。
*** 选择*主*以手动将主NTP角色分配给节点。每个站点至少应有两个节点具有Primary角色、以便为外部计时源提供冗余系统访问。
*** 选择*Client*以手动将客户端NTP角色分配给节点。




 a| 
ADC服务(组合存储节点或纯元数据存储节点)
 a| 
此存储节点是否将运行管理域控制器 (ADC) 服务。 ADC 服务跟踪电网服务的位置和可用性。每个站点至少有三个存储节点必须包含 ADC 服务。

*** 如果您要更换的存储节点包括 ADC 服务，请选择*是*。由于如果剩余的 ADC 服务太少，您就无法停用存储节点，因此此设置可确保在删除旧服务之前有新的 ADC 服务可用。
*** 你可以link:../maintain/move-adc-service.html["将 ADC 服务移至同一站点上的另一个存储节点"]以确保满足 ADC 服务法定人数。
*** 选择*自动*让系统确定此节点是否需要ADC服务。


了解link:../maintain/understanding-adc-service-quorum.html["ADC仲裁"]。



 a| 
存储级别(组合存储节点或纯数据存储节点)
 a| 
使用*Default*存储级别，或选择要分配给此新节点的自定义存储级别。

存储级别由ILM存储池使用、因此您的选择可能会影响要放置在存储节点上的对象。

|===
.. 根据需要修改网格网络，管理网络和客户端网络的设置。
+
*** * IPv4 地址（ CIDR ） * ：网络接口的 CIDR 网络地址。例如： 172.16.10.100/24
+

NOTE: 如果在批准节点时发现节点在网格网络上具有重复的IP地址、则必须取消扩展、使用非重复IP重新部署虚拟机或设备、然后重新启动扩展。

*** * 网关 * ：网格节点的默认网关。例如： 172.16.10.1
*** * 子网（ CIDR ） * ：管理网络的一个或多个子网。


.. 选择 * 保存 * 。
+
批准的网格节点将移至批准的节点列表。

+
*** 要修改已批准的网格节点的属性，请选择其单选按钮，然后选择 * 编辑 * 。
*** 要将已批准的网格节点移回 "Pending Nodes" 列表，请选择其单选按钮，然后选择 * 重置 * 。
*** 要永久删除已批准的网格节点，请关闭此节点。然后，选择其单选按钮并选择 * 删除 * 。


.. 对要批准的每个待定网格节点重复上述步骤。
+

NOTE: 如果可能，您应批准所有待定网格注释并执行一次扩展。如果执行多个小型扩展，则需要更多时间。



. 批准所有网格节点后，输入 * 配置密码短语 * ，然后选择 * 扩展 * 。
+
几分钟后，此页面将更新以显示扩展操作步骤 的状态。如果正在执行影响各个网格节点的任务、则"Grid Node Status"部分将列出每个网格节点的当前状态。

+

NOTE: 在新设备的"安装网格节点"步骤中、StorageGRID设备安装程序会显示安装从第3阶段移至第4阶段"完成安装"。阶段 4 完成后，控制器将重新启动。

+

NOTE: 站点扩展包括一项额外任务，用于为新站点配置 Cassandra 。

. 一旦出现*下载恢复包*链接，请下载恢复包文件。
+
对StorageGRID系统进行网格拓扑更改后，您必须尽快下载恢复包文件的更新副本。如果发生故障，恢复包文件可让您恢复系统。

+
.. 选择下载链接。
.. 输入配置密码短语，然后选择 * 开始下载 * 。
.. 下载完成后、打开 `.zip`文件并确认您可以访问其中的内容、包括 `Passwords.txt`文件。
.. 复制下载的恢复包文件(`.zip`）到两个安全、可靠且独立的位置。
+

CAUTION: 恢复包文件必须是安全的，因为它包含可用于从StorageGRID系统获取数据的加密密钥和密码。



. 如果要向现有站点添加存储节点或添加站点、请监控Cassandr阶段、这些阶段会在新网格节点上启动服务时发生。
+

CAUTION: 在"扩展Cassandr集群"或"启动Cassandr并流式传输数据"阶段、请勿重新启动任何存储节点。对于每个新存储节点，这些阶段可能需要花费数小时才能完成，尤其是在现有存储节点包含大量对象元数据的情况下。

+
[role="tabbed-block"]
====
.正在添加存储节点
--
如果要向现有站点添加存储节点、请查看"正在启动cassand拉 并流式传输数据"状态消息中显示的百分比。

此百分比根据可用的 Cassandra 数据总量以及已写入新节点的数据量估计 Cassandra 流操作的完成程度。

--
.正在添加站点
--
如果要添加新站点、请使用 `nodetool status`监控cassanda流式传输的进度、并查看在"扩展cassanda集群"阶段向新站点复制了多少元数据。新站点上的总数据负载应介于当前站点总负载的 20% 左右。

--
====
. 继续监控扩展，直到所有任务均完成，并且 * 配置扩展 * 按钮再次出现。


.完成后
根据您添加的网格节点类型、执行其他集成和配置步骤。请参阅。 link:configuring-expanded-storagegrid-system.html["扩展后的配置步骤"]
