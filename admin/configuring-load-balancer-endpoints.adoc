---
permalink: admin/configuring-load-balancer-endpoints.html 
sidebar: sidebar 
keywords: how to configure load balancer endpoint, how to attach certificate to load balancer endpoint 
summary: 负载平衡器端点用于确定S3客户端在连接到网关和管理节点上的StorageGRID负载平衡器时可以使用的端口和网络协议。您还可以使用端点访问网格管理器、租户管理器或这两者。 
---
= 配置负载平衡器端点
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
负载平衡器端点用于确定S3客户端在连接到网关和管理节点上的StorageGRID负载平衡器时可以使用的端口和网络协议。您还可以使用端点访问网格管理器、租户管理器或这两者。


TIP: Swift详细信息已从此版本的文档站点中删除。请参阅。 https://docs.netapp.com/us-en/storagegrid-118/admin/configuring-client-connections.html["配置 S3 和 Swift 客户端连接"^]

.开始之前
* 您已使用登录到网格管理器link:../admin/web-browser-requirements.html["支持的 Web 浏览器"]。
* 您拥有link:admin-group-permissions.html["root访问权限"]。
* 您已查看link:managing-load-balancing.html["负载平衡注意事项"]。
* 如果先前已重新映射要用于负载平衡器端点的端口，则已创建link:../maintain/removing-port-remaps.html["已删除端口重新映射"]。
* 您已创建计划使用的任何高可用性（ HA ）组。建议使用 HA 组，但不要求使用 HA 组。请参阅。 link:managing-high-availability-groups.html["管理高可用性组"]
* 如果负载平衡器端点将由使用link:../admin/manage-s3-select-for-tenant-accounts.html["S3 Select 的 S3 租户"]，则不能使用任何裸机节点的IP地址或FQDN。用于S3 Select的负载平衡器端点仅允许使用服务设备和基于VMware的软件节点。
* 您已配置计划使用的任何 VLAN 接口。请参阅。 link:configure-vlan-interfaces.html["配置 VLAN 接口"]
* 如果要创建 HTTPS 端点（建议），则您具有服务器证书的信息。
+

NOTE: 对端点证书所做的更改可能需要长达 15 分钟才能应用于所有节点。

+
** 要上传证书，您需要服务器证书，证书专用密钥以及 CA 捆绑包（可选）。
** 要生成证书、您需要S3客户端用于访问此端点的所有域名和IP地址。您还必须知道主题（可分辨名称）。
** 如果要使用StorageGRID S3 API证书(也可用于直接连接到存储节点)、则表示您已将默认证书替换为由外部证书颁发机构签名的自定义证书。请参阅。 link:../admin/configuring-custom-server-certificate-for-storage-node.html["配置S3 API证书"]






== 创建负载平衡器端点

每个S3客户端负载平衡器端点指定一个端口、一个客户端类型(S3)和一个网络协议(HTTP或HTTPS)。管理接口负载平衡器端点指定端口、接口类型和不可信的客户端网络。



=== 访问向导

.步骤
. 选择 * 配置 * > * 网络 * > * 负载平衡器端点 * 。
. 要为S3或Swift客户端创建端点，请选择*S3或Swift client*选项卡。
. 要创建端点以访问网格管理器、租户管理器或这两者，请选择*管理接口*选项卡。
. 选择 * 创建 * 。




=== 输入端点详细信息

.步骤
. 选择相应的说明、为要创建的端点类型输入详细信息。


[role="tabbed-block"]
====
.S3或Swift客户端
--
[cols="1a,3a"]
|===
| 字段 | 说明 


 a| 
名称
 a| 
端点的描述性名称，将显示在负载平衡器端点页面的表中。



 a| 
端口
 a| 
要用于负载平衡的 StorageGRID 端口。对于您创建的第一个端点、此字段默认为10433、但您可以输入介于1到65535之间的任何未使用的外部端口。

如果输入*80*或*8443*，则仅在网关节点上配置端点，除非释放端口8443。然后、您可以使用端口8443作为S3端点、此端口将同时在网关节点和管理节点上进行配置。



 a| 
客户端类型
 a| 
要使用此端点的客户端应用程序类型，可以是 * S3 或 * Swift* 。



 a| 
网络协议
 a| 
客户端在连接到此端点时将使用的网络协议。

* 选择 * HTTPS * 可进行安全的 TLS 加密通信（建议）。您必须附加安全证书，然后才能保存此端点。
* 选择 * HTTP * 可实现不太安全的未加密通信。对于非生产网格，请仅使用 HTTP 。


|===
--
.管理接口
--
[cols="1a,3a"]
|===
| 字段 | 说明 


 a| 
名称
 a| 
端点的描述性名称，将显示在负载平衡器端点页面的表中。



 a| 
端口
 a| 
要用于访问网格管理器和/或租户管理器的StorageGRID端口。

* 网格管理器：*8443*
* 租户管理器：*9443*
* 网格管理器和租户管理器：*443*


*注*：您可以使用这些预设端口或其他可用端口。



 a| 
接口类型
 a| 
选择要使用此端点访问的StorageGRID接口对应的单选按钮。



 a| 
不可信客户端网络
 a| 
如果此端点应可供不可信的客户端网络访问，请选择*是*。否则，请选择*No*。

选择*是*时，端口在所有不可信的客户端网络上打开。

*注意*：创建负载平衡器端点时，只能将端口配置为对不可信客户端网络开放或关闭。

|===
--
====
. 选择 * 继续 * 。




=== 选择绑定模式

.步骤
. 为端点选择绑定模式、以控制如何使用任何IP地址或特定IP地址和网络接口访问端点。
+
某些绑定模式可用于客户端端点或管理接口端点。此处列出了这两种端点类型的所有模式。

+
[cols="1a,3a"]
|===
| 模式 | 说明 


 a| 
全局(默认用于客户端端点)
 a| 
客户端可以使用任何网关节点或管理节点的IP地址、任何网络上任何HA组的虚拟IP (VIP)地址或相应的FQDN访问端点。

除非需要限制此端点的可访问性，否则请使用*Global"设置。



 a| 
HA 组的虚拟 IP
 a| 
客户端必须使用HA组的虚拟IP地址(或相应的FQDN)才能访问此端点。

具有此绑定模式的端点都可以使用相同的端口号、只要为端点选择的HA组不重叠即可。



 a| 
节点接口
 a| 
客户端必须使用选定节点接口的IP地址(或相应FQDN)才能访问此端点。



 a| 
节点类型(仅限客户端端点)
 a| 
根据您选择的节点类型、客户端必须使用任何管理节点的IP地址(或相应的FQDN)或任何网关节点的IP地址(或相应的FQDN)来访问此端点。



 a| 
所有管理节点(默认用于管理接口端点)
 a| 
客户端必须使用任何管理节点的IP地址(或相应的FQDN)才能访问此端点。

|===
+
如果多个端点使用同一端口，StorageGRID 将使用此优先级顺序来确定要使用的端点：*HA组的虚拟IP *>*Node interfaces*>*Node type*>*Global"。

+
如果要创建管理接口端点、则仅允许使用管理节点。

. 如果选择了 * HA 组的虚拟 IP * ，请选择一个或多个 HA 组。
+
如果要创建管理接口端点、请选择仅与管理节点关联的VIP。

. 如果选择了 * 节点接口 * ，请为要与此端点关联的每个管理节点或网关节点选择一个或多个节点接口。
. 如果选择了*Node type*，请选择管理节点(包括主管理节点和任何非主管理节点)或网关节点。




=== 控制租户访问


NOTE: 只有当管理接口端点具有时，该端点才能控制租户访问<<enter-endpoint-details,租户管理器的接口类型>>。

.步骤
. 对于*租户访问*步骤，请选择以下选项之一：
+
[cols="1a,2a"]
|===
| 字段 | 说明 


 a| 
允许所有租户(默认)
 a| 
所有租户帐户都可以使用此端点来访问其分段。

如果尚未创建任何租户帐户、则必须选择此选项。添加租户帐户后、您可以编辑负载平衡器端点以允许或阻止特定帐户。



 a| 
允许选定租户
 a| 
只有选定租户帐户才能使用此端点访问其分段。



 a| 
阻止选定租户
 a| 
选定租户帐户无法使用此端点访问其分段。所有其他租户均可使用此端点。

|===
. 如果要创建*HTTP*端点，则不需要附加证书。选择 * 创建 * 以添加新的负载平衡器端点。然后，转到<<after-you-finish,完成后>>。否则，请选择 * 继续 * 以附加证书。




=== 附加证书

.步骤
. 如果要创建 * HTTPS * 端点，请选择要附加到该端点的安全证书类型。
+
此证书可确保S3客户端与管理节点或网关节点上的负载平衡器服务之间的连接安全。

+
** * 上传证书 * 。如果您要上传自定义证书，请选择此选项。
** * 生成证书 * 。如果您具有生成自定义证书所需的值，请选择此选项。
** *使用StorageGRID S3证书*。如果要使用全局S3 API证书、则选择此选项、此证书也可用于直接连接到存储节点。
+
您无法选择此选项、除非已将默认S3 API证书(由网格CA签名)替换为由外部证书颁发机构签名的自定义证书。请参阅。 link:../admin/configuring-custom-server-certificate-for-storage-node.html["配置S3 API证书"]

** *使用管理接口证书*。如果要使用全局管理接口证书、则选择此选项、此证书也可用于直接连接到管理节点。


. 如果您未使用StorageGRID S3证书、请上传或生成此证书。
+
[role="tabbed-block"]
====
.上传证书
--
.. 选择 * 上传证书 * 。
.. 上传所需的服务器证书文件：
+
*** * 服务器证书 * ： PEM 编码的自定义服务器证书文件。
*** *证书专用密钥*:自定义服务器证书专用密钥文件(`.key`)。
+

NOTE: EC 私钥必须大于或等于 224 位。RSA 私钥必须大于或等于 2048 位。

*** * CA bundle* ：一个可选文件，其中包含来自每个中间颁发证书颁发机构（ CA ）的证书。此文件应包含 PEM 编码的每个 CA 证书文件，并按证书链顺序串联。


.. 展开 * 证书详细信息 * 以查看您上传的每个证书的元数据。如果您上传了可选的 CA 包，则每个证书都会显示在其自己的选项卡上。
+
*** 选择 * 下载证书 * 以保存证书文件，或者选择 * 下载 CA 捆绑包 * 以保存证书捆绑包。
+
指定证书文件名和下载位置。使用扩展名保存文件 `.pem`。

+
例如： `storagegrid_certificate.pem`

*** 选择 * 复制证书 PEM* 或 * 复制 CA 捆绑包 PEM* ，将证书内容复制到其他位置进行粘贴。


.. 选择 * 创建 * 。+ 已创建负载平衡器端点。自定义证书将用于S3客户端或管理接口与端点之间的所有后续新连接。


--
.生成证书
--
.. 选择 * 生成证书 * 。
.. 指定证书信息：
+
[cols="1a,3a"]
|===
| 字段 | 说明 


 a| 
域名
 a| 
要包含在证书中的一个或多个完全限定域名。使用 * 作为通配符表示多个域名。



 a| 
IP
 a| 
要包含在证书中的一个或多个IP地址。



 a| 
主题(可选)
 a| 
证书所有者的X.509主题或可分辨名称(DN)。

如果未在此字段中输入值、则生成的证书将使用第一个域名或IP地址作为使用者公用名(CN)。



 a| 
有效天数
 a| 
创建后证书过期的天数。



 a| 
添加密钥用法扩展
 a| 
如果选中(默认值和建议值)、则会将密钥用法和扩展密钥用法扩展添加到生成的证书中。

这些扩展定义了证书中所含密钥的用途。

*注意*：除非证书包含这些扩展时遇到与旧客户端的连接问题，否则请保持选中此复选框。

|===
.. 选择 * 生成 * 。
.. 选择 * 证书详细信息 * 可查看生成的证书的元数据。
+
*** 选择 * 下载证书 * 以保存证书文件。
+
指定证书文件名和下载位置。使用扩展名保存文件 `.pem`。

+
例如： `storagegrid_certificate.pem`

*** 选择 * 复制证书 PEM* 将证书内容复制到其他位置进行粘贴。


.. 选择 * 创建 * 。
+
此时将创建负载平衡器端点。自定义证书将用于S3客户端或管理接口与此端点之间的所有后续新连接。



--
====




=== 完成后

.步骤
. 如果使用DNS、请确保DNS包含一条记录、用于将StorageGRID 完全限定域名(FQDN)与客户端用于建立连接的每个IP地址相关联。
+
在 DNS 记录中输入的 IP 地址取决于您是否使用的是由负载平衡节点组成的 HA 组：

+
** 如果已配置HA组、则客户端将连接到该HA组的虚拟IP地址。
** 如果不使用HA组、则客户端将使用网关节点或管理节点的IP地址连接到StorageGRID 负载平衡器服务。
+
此外，还必须确保 DNS 记录引用所有必需的端点域名，包括任何通配符名称。



. 为S3客户端提供连接到端点所需的信息：
+
** 端口号
** 完全限定域名或 IP 地址
** 任何必需的证书详细信息






== 查看和编辑负载平衡器端点

您可以查看现有负载平衡器端点的详细信息，包括安全端点的证书元数据。您可以更改端点的某些设置。

* 要查看所有负载平衡器端点的基本信息、请查看"负载平衡器端点"页面上的表。
* 要查看有关特定端点的所有详细信息，包括证书元数据，请在表中选择端点的名称。显示的信息因端点类型及其配置方式而异。
+
image::../media/load_balancer_endpoint_details.png[负载平衡器端点详细信息]

* 要编辑端点，请使用“负载平衡器端点”页面上的*Actions*菜单。
+

NOTE: 如果在编辑管理接口端点的端口时无法访问网格管理器、请更新URL和端口以重新获取访问权限。

+

TIP: 编辑端点后，您可能需要等待长达 15 分钟，才能将所做的更改应用于所有节点。

+
[cols="1a, 2a,2a"]
|===
| 任务 | 操作菜单 | 详细信息页面 


 a| 
编辑端点名称
 a| 
.. 选中此端点对应的复选框。
.. 选择 * 操作 * > * 编辑端点名称 * 。
.. 输入新名称。
.. 选择 * 保存 * 。

 a| 
.. 选择端点名称以显示详细信息。
.. 选择编辑图标。image:../media/icon_edit_tm.png["编辑图标"]
.. 输入新名称。
.. 选择 * 保存 * 。




 a| 
编辑端点端口
 a| 
.. 选中此端点对应的复选框。
.. 选择*Actions*>*编辑端点端口*
.. 输入有效的端口号。
.. 选择 * 保存 * 。

 a| 
_n/A_



 a| 
编辑端点绑定模式
 a| 
.. 选中此端点对应的复选框。
.. 选择 * 操作 * > * 编辑端点绑定模式 * 。
.. 根据需要更新绑定模式。
.. 选择 * 保存更改 * 。

 a| 
.. 选择端点名称以显示详细信息。
.. 选择 * 编辑绑定模式 * 。
.. 根据需要更新绑定模式。
.. 选择 * 保存更改 * 。




 a| 
编辑端点证书
 a| 
.. 选中此端点对应的复选框。
.. 选择 * 操作 * > * 编辑端点证书 * 。
.. 根据需要上传或生成新的自定义证书、或者开始使用全局S3证书。
.. 选择 * 保存更改 * 。

 a| 
.. 选择端点名称以显示详细信息。
.. 选择 * 证书 * 选项卡。
.. 选择 * 编辑证书 * 。
.. 根据需要上传或生成新的自定义证书、或者开始使用全局S3证书。
.. 选择 * 保存更改 * 。




 a| 
编辑租户访问
 a| 
.. 选中此端点对应的复选框。
.. 选择*操作*>*编辑租户访问*。
.. 选择其他访问选项、从列表中选择或删除租户、或者同时执行这两项操作。
.. 选择 * 保存更改 * 。

 a| 
.. 选择端点名称以显示详细信息。
.. 选择*租户访问*选项卡。
.. 选择*编辑租户访问*。
.. 选择其他访问选项、从列表中选择或删除租户、或者同时执行这两项操作。
.. 选择 * 保存更改 * 。


|===




== 删除负载平衡器端点

您可以使用 * 操作 * 菜单删除一个或多个端点，也可以从详细信息页面中删除单个端点。


CAUTION: 为防止客户端中断、请在删除负载平衡器端点之前更新任何受影响的S3客户端应用程序。更新每个客户端以使用分配给另一个负载平衡器端点的端口进行连接。请务必同时更新所需的任何证书信息。


NOTE: 如果在删除管理接口端点时无法访问网格管理器、请更新此URL。

* 删除一个或多个端点：
+
.. 在"负载平衡器"页面中、选中要删除的每个端点对应的复选框。
.. 选择 * 操作 * > * 删除 * 。
.. 选择 * 确定 * 。


* 从详细信息页面中删除一个端点：
+
.. 从"负载平衡器"页面中、选择端点名称。
.. 在详细信息页面上选择 * 删除 * 。
.. 选择 * 确定 * 。



