---
permalink: admin/grid-federation-manage-connection.html 
sidebar: sidebar 
keywords: grid federation, edit connection, remove connection, rotate certificates 
summary: 管理StorageGRID 系统之间的网格联合连接包括编辑连接详细信息、轮换证书、删除租户权限以及删除未使用的连接。 
---
= 管理网格联合连接
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
管理StorageGRID 系统之间的网格联合连接包括编辑连接详细信息、轮换证书、删除租户权限以及删除未使用的连接。

.开始之前
* 您已使用登录到任一网格上的网格管理器link:../admin/web-browser-requirements.html["支持的 Web 浏览器"]。
* 您拥有已登录到的网格的link:admin-group-permissions.html["root访问权限"]。




== [[Edit_GRID_FED_CONNECTION ]]编辑网格联合连接

您可以通过登录到连接中任一网格上的主管理节点来编辑网格联合连接。更改第一个网格后、必须下载新的验证文件并将其上传到另一个网格。


NOTE: 编辑连接时、帐户克隆或跨网格复制请求将继续使用现有连接设置。对第一个网格所做的任何编辑都将保存在本地、但只有在上传到第二个网格并进行保存和测试后、才会使用。



=== 开始编辑连接

.步骤
. 从任一网格上的主管理节点登录到网格管理器。
. 选择*节点*并确认系统中的所有其他管理节点都在线。
+

NOTE: 编辑网格联合连接时、StorageGRID 会尝试在第一个网格的所有管理节点上保存"候选配置"文件。如果无法将此文件保存到所有管理节点，则在选择*保存并测试*时会显示一条警告消息。

. 选择*配置* > *系统* > *网格联合*。
. 使用“网格联合”页面或特定连接的详细信息页面上的*Actions*菜单编辑连接详细信息。请参见link:grid-federation-create-connection.html["创建网格联合连接"]了解要输入的内容。
+
[role="tabbed-block"]
====
.操作菜单
--
.. 选择连接的单选按钮。
.. 选择*Actions*>*Edit*。
.. 输入新信息。


--
.详细信息页面
--
.. 选择连接名称以显示其详细信息。
.. 选择 * 编辑 * 。
.. 输入新信息。


--
====
. 输入要登录到的网格的配置密码短语。
. 选择*保存并继续*。
+
新值将被保存、但在将新验证文件上传到另一个网格之前、这些值不会应用于连接。

. 选择*下载验证文件*。
+
要稍后下载此文件、请转到连接的详细信息页面。

. 找到下载的文件(`_connection-name_.grid-federation`，并将其保存到安全的位置。
+

CAUTION: 验证文件包含机密信息、必须安全地存储和传输。

. 选择*Close*(关闭*)返回到Grid Federation (网格联合)页面。
. 确认*连接状态*为*待定编辑*。
+

NOTE: 如果在开始编辑连接时连接状态不是*conned*，则不会更改为*Pending edit*。

. 将文件提供 `_connection-name_.grid-federation`给另一个网格的网格管理员。




=== 完成对连接的编辑

通过将验证文件上传到其他网格来完成对连接的编辑。

.步骤
. 从主管理节点登录到网格管理器。
. 选择*配置* > *系统* > *网格联合*。
. 选择*上传验证文件*以访问上传页面。
. 选择*上传验证文件*。然后、浏览并选择从第一个网格下载的文件。
. 输入当前已登录的网格的配置密码短语。
. 选择*保存并测试*。
+
如果可以使用编辑的值建立连接、则会显示一条成功消息。否则、将显示错误消息。查看消息并解决任何问题。

. 关闭向导以返回到"网格联盟"页面。
. 确认*连接状态*为*已连接*。
. 转到第一个网格上的"网格联合"页面并刷新浏览器。确认*连接状态*现在为*已连接*。
. 建立连接后、安全地删除验证文件的所有副本。




== [[test_grid _ FED_CONNECTION ]]测试网格联合连接

.步骤
. 从主管理节点登录到网格管理器。
. 选择*配置* > *系统* > *网格联合*。
. 使用“网格联合”页面或详细信息页面上的*Actions*菜单测试特定连接。
+
[role="tabbed-block"]
====
.操作菜单
--
.. 选择连接的单选按钮。
.. 选择*Actions*>*Test*。


--
.详细信息页面
--
.. 选择连接名称以显示其详细信息。
.. 选择 * 测试连接 * 。


--
====
. 查看连接状态：
+
[cols="1a,2a"]
|===
| 连接状态 | 说明 


 a| 
已连接
 a| 
两个网格均已连接并正常通信。



 a| 
错误
 a| 
连接处于错误状态。例如、证书已过期或配置值不再有效。



 a| 
待编辑
 a| 
您已编辑此网格上的连接、但此连接仍在使用现有配置。要完成编辑、请将新验证文件上传到另一个网格。



 a| 
正在等待连接
 a| 
您已在此网格上配置连接、但在另一网格上连接尚未完成。从此网格下载验证文件并将其上传到另一个网格。



 a| 
未知
 a| 
连接处于未知状态、可能是由于网络问题描述 或脱机节点。

|===
. 如果连接状态为*Error*，请解决所有问题。然后，再次选择*测试连接*以确认问题描述 已修复。




== [[rotate_grid _ FED_certificates]]旋转连接证书

每个网格联合连接都使用四个自动生成的SSL证书来保护此连接的安全。当每个网格的两个证书接近其到期日期时，“*网格联合证书到期*”警报将提醒您轮换证书。


CAUTION: 如果连接任一端的证书过期、则连接将停止工作、复制将处于待定状态、直到证书更新为止。

.步骤
. 从任一网格上的主管理节点登录到网格管理器。
. 选择*配置* > *系统* > *网格联合*。
. 从网格联盟页面上的任一选项卡中、选择连接名称以显示其详细信息。
. 选择*证书*选项卡。
. 选择*旋转证书*。
. 指定新证书的有效天数。
. 输入要登录到的网格的配置密码短语。
. 选择*旋转证书*。
. 根据需要、对连接中的另一个网格重复上述步骤。
+
通常、对连接两端的证书使用相同天数。





== [[remove_grid _ FED_CONNECTION ]]删除网格联合连接

您可以从连接中的任一网格删除网格联合连接。如图所示、您必须在两个网格上执行前提条件步骤、以确认任一网格上的任何租户均未使用此连接。

image::../media/grid-federation-remove-connection.png[删除网格联合连接的步骤]

删除连接之前、请注意以下事项：

* 删除连接不会删除已在网格之间复制的任何项目。例如、删除租户的权限后、不会从任一网格中删除存在于两个网格上的租户用户、组和对象。如果要删除这些项目、则必须手动将其从两个网格中删除。
* 删除连接后、任何正在等待复制的对象(已装载但尚未复制到另一个网格)的复制将永久失败。




=== 对所有租户分段禁用复制

.步骤
. 从任一网格开始、从主管理节点登录到网格管理器。
. 选择*配置* > *系统* > *网格联合*。
. 选择连接名称以显示其详细信息。
. 在*允许的租户*选项卡上、确定是否有任何租户正在使用此连接。
. 如果列出了任何租户、则指示所有租户针对连接中两个网格上的所有分段执行link:../tenant/grid-federation-manage-cross-grid-replication.html["禁用跨网格复制"]。
+

TIP: 如果任何租户分段已启用跨网格复制、则无法删除*使用网格联合连接*权限。每个租户帐户都必须在两个网格上为其分段禁用跨网格复制。





=== 删除每个租户的权限

对所有租户分段禁用跨网格复制后、从两个网格上的所有租户中删除*使用网格联合权限*。

.步骤
. 选择*配置* > *系统* > *网格联合*。
. 选择连接名称以显示其详细信息。
. 对于*允许的租户*选项卡上的每个租户、从每个租户中删除*使用网格联合连接*权限。请参阅。 link:grid-federation-manage-tenants.html["管理允许的租户"]
. 对其他网格上允许的租户重复上述步骤。




=== 断开连接

.步骤
. 如果任一网格上没有租户正在使用此连接，请选择*Remove*。
. 查看确认消息，然后选择*Remove*。
+
** 如果可以删除连接、则会显示一条成功消息。现在、两个网格中的网格联合连接均已删除。
** 如果无法删除连接(例如、连接仍在使用中或出现连接错误)、则会显示一条错误消息。您可以执行以下任一操作：
+
*** 解决此错误(建议)。请参阅。 link:grid-federation-troubleshoot.html["对网格联合错误进行故障排除"]
*** 强制断开连接。请参见下一节。








== [[FORCE-Remove_GRY_FED_CONNECTION ]]强制删除网格联合连接

如有必要，您可以强制删除未处于*已连接*状态的连接。

强制删除仅会从本地网格中删除此连接。要完全断开连接、请在两个滤线栅上执行相同的步骤。

.步骤
. 从确认对话框中，选择*Force remove*。
+
此时将显示一条成功消息。无法再使用此网格联合连接。但是、租户分段可能仍会启用跨网格复制、并且某些对象副本可能已在连接中的网格之间进行复制。

. 从连接中的另一个网格、从主管理节点登录到网格管理器。
. 选择*配置* > *系统* > *网格联合*。
. 选择连接名称以显示其详细信息。
. 选择*Remove*和*Yes*。
. 选择*Force remove*以从该网格中删除连接。

