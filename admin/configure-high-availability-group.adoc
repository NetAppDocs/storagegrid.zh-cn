---
permalink: admin/configure-high-availability-group.html 
sidebar: sidebar 
keywords: how to configure high availability group, node priority order, failover 
summary: 您可以配置高可用性 \ （ HA\ ）组，以提供对管理节点或网关节点上服务的高可用性访问。 
---
= 配置高可用性组
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
您可以配置高可用性（ High Availability ， HA ）组，以提供对管理节点或网关节点上服务的高可用性访问。

.开始之前
* 您已使用登录到网格管理器link:../admin/web-browser-requirements.html["支持的 Web 浏览器"]。
* 您拥有link:admin-group-permissions.html["root访问权限"]。
* 如果您计划在 HA 组中使用 VLAN 接口，则已创建 VLAN 接口。请参阅。 link:../admin/configure-vlan-interfaces.html["配置 VLAN 接口"]
* 如果您计划对 HA 组中的节点使用访问接口，则已创建此接口：
+
** *Red Hat Enterprise Linux (安装节点之前)*：link:../rhel/creating-node-configuration-files.html["创建节点配置文件"]
** *Ubuntu或Debian (安装节点之前)*：link:../ubuntu/creating-node-configuration-files.html["创建节点配置文件"]
** *Linux (安装节点后)*：link:../maintain/linux-adding-trunk-or-access-interfaces-to-node.html["Linux ：向节点添加中继或访问接口"]
** *VMware (安装节点后)*：link:../maintain/vmware-adding-trunk-or-access-interfaces-to-node.html["VMware ：向节点添加中继或访问接口"]






== 创建高可用性组

创建高可用性组时，您可以选择一个或多个接口并按优先级顺序对其进行组织。然后，您将一个或多个 VIP 地址分配给该组。

接口必须是要将网关节点或管理节点包含在 HA 组中的接口。一个 HA 组只能对任何给定节点使用一个接口；但是，同一节点的其他接口也可以在其他 HA 组中使用。



=== 访问向导

.步骤
. 选择 * 配置 * > * 网络 * > * 高可用性组 * 。
. 选择 * 创建 * 。




=== 输入 HA 组的详细信息

.步骤
. 为 HA 组提供一个唯一名称。
. 或者，输入 HA 组的问题描述 。
. 选择 * 继续 * 。




=== 向 HA 组添加接口

.步骤
. 选择一个或多个接口以添加到此 HA 组。
+
使用列标题对行进行排序，或者输入搜索词以更快地找到接口。

+
image::../media/ha_group_add_interfaces.png[HA 组添加接口]

+

NOTE: 创建 VLAN 接口后，请等待最多 5 分钟，使新接口显示在表中。

+
.选择接口的准则
** 必须至少选择一个接口。
** 您只能为一个节点选择一个接口。
** 如果 HA 组用于管理节点服务（包括网格管理器和租户管理器）的 HA 保护，请仅选择管理节点上的接口。
** 如果HA组用于对S3客户端流量进行HA保护、请选择管理节点和/或网关节点上的接口。
** 如果选择不同类型节点上的接口，则会显示一条信息性注释。系统会提醒您，如果发生故障转移，则新活动节点上可能无法使用先前活动节点提供的服务。例如、备份网关节点无法为管理节点服务提供HA保护。同样、备份管理节点无法执行主管理节点可以提供的所有维护过程。
** 如果无法选择接口、则会禁用其复选框。工具提示提供了更多信息。
+
image::../media/vlan_parent_interface_tooltip.png[VLAN 接口工具提示]

** 如果某个接口的子网值或网关与另一个选定接口冲突、则无法选择该接口。
** 如果已配置接口没有静态IP地址、则无法选择该接口。


. 选择 * 继续 * 。




=== 确定优先级顺序

如果HA组包含多个接口、则可以确定哪个是主接口、哪些是备份(故障转移)接口。如果主接口发生故障、VIP地址将移至可用的最高优先级接口。如果该接口发生故障， VIP 地址将移至可用的下一个最高优先级接口，依此类推。

.步骤
. 拖动*优先级顺序*列中的行以确定主接口和任何备份接口。
+
列表中的第一个接口是主接口。主接口是活动接口，除非发生故障。

+
image::../media/ha_group_determine_failover.png[HA 组确定优先级顺序]

+

TIP: 如果 HA 组提供对网格管理器的访问权限，则必须选择主管理节点上的一个接口作为主接口。某些维护过程只能从主管理节点执行。

. 选择 * 继续 * 。




=== 输入 IP 地址

.步骤
. 在 * 子网 CIDR * 字段中，以 CIDR 表示法指定 VIP 子网— IPv4 地址后跟斜杠和子网长度（ 0-32 ）。
+
网络地址不能设置任何主机位。例如， `192.16.0.0/22`。

+

NOTE: 如果使用 32 位前缀，则 VIP 网络地址也会用作网关地址和 VIP 地址。

+
image::../media/ha_group_select_virtual_ips.png[HA 组输入 VIP]

. (可选)如果任何S3管理或租户客户端要从其他子网访问这些VIP地址，请输入*网关IP地址*。网关地址必须在 VIP 子网中。
+
客户端和管理员用户将使用此网关访问虚拟 IP 地址。

. 为HA组中的活动接口至少输入一个VIP地址、最多输入十个VIP地址。所有VIP地址都必须位于VIP子网中、并且所有VIP地址都将在活动接口上同时处于活动状态。
+
您必须至少提供一个 IPv4 地址。您也可以指定其他 IPv4 和 IPv6 地址。

. 选择 * 创建 HA 组 * 并选择 * 完成 * 。
+
此时将创建 HA 组，您现在可以使用已配置的虚拟 IP 地址。





=== 后续步骤

如果要使用此 HA 组进行负载平衡，请创建一个负载平衡器端点以确定端口和网络协议并附加任何所需的证书。请参阅。 link:configuring-load-balancer-endpoints.html["配置负载平衡器端点"]



== 编辑高可用性组

您可以编辑高可用性（ High Availability ， HA ）组以更改其名称和问题描述 ，添加或删除接口，更改优先级顺序或添加或更新虚拟 IP 地址。

例如，如果要删除与站点或节点停用操作步骤 中选定接口关联的节点，则可能需要编辑 HA 组。

.步骤
. 选择 * 配置 * > * 网络 * > * 高可用性组 * 。
+
" 高可用性组 " 页面显示所有现有的 HA 组。

. 选中要编辑的HA组对应的复选框。
. 根据要更新的内容执行以下操作之一：
+
** 选择 * 操作 * > * 编辑虚拟 IP 地址 * 以添加或删除 VIP 地址。
** 选择 * 操作 * > * 编辑 HA 组 * 可更新组的名称或问题描述 ，添加或删除接口，更改优先级顺序或添加或删除 VIP 地址。


. 如果选择了 * 编辑虚拟 IP 地址 * ：
+
.. 更新 HA 组的虚拟 IP 地址。
.. 选择 * 保存 * 。
.. 选择 * 完成 * 。


. 如果选择了 * 编辑 HA 组 * ：
+
.. （可选）更新组的名称或问题描述 。
.. (可选)选中或清除相应复选框以添加或删除接口。
+

NOTE: 如果 HA 组提供对网格管理器的访问权限，则必须选择主管理节点上的一个接口作为主接口。某些维护过程只能从主管理节点执行

.. (可选)拖动行以更改此HA组的主接口和任何备份接口的优先级顺序。
.. 也可以更新虚拟 IP 地址。
.. 选择 * 保存 * ，然后选择 * 完成 * 。






== 删除高可用性组

您可以一次删除一个或多个高可用性（ HA ）组。


TIP: 如果HA组绑定到负载平衡器端点、则无法删除该HA组。要删除HA组、必须将其从使用该组的任何负载平衡器端点中删除。

要防止客户端中断、请在删除HA组之前更新任何受影响的S3客户端应用程序。更新每个客户端以使用其他 IP 地址进行连接，例如，安装期间为接口配置的不同 HA 组的虚拟 IP 地址或 IP 地址。

.步骤
. 选择 * 配置 * > * 网络 * > * 高可用性组 * 。
. 查看要删除的每个HA组的*负载平衡器端点*列。如果列出了任何负载平衡器端点：
+
.. 转到*configuration*>*Network*>*负载平衡器端点*。
.. 选中此端点对应的复选框。
.. 选择 * 操作 * > * 编辑端点绑定模式 * 。
.. 更新绑定模式以删除HA组。
.. 选择 * 保存更改 * 。


. 如果未列出负载平衡器端点、请选中要删除的每个HA组对应的复选框。
. 选择*Actions*>*Remove HA group*。
. 查看此消息并选择 * 删除 HA 组 * 以确认您的选择。
+
选定的所有 HA 组都将被删除。高可用性组页面上会显示一个绿色的成功横幅。


